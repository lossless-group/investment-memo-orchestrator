# Release v0.3.0

**Investment Memo Orchestrator** - Multi-agent system for generating professional investment memos using LangGraph and Claude.

This release introduces the **firm-scoped IO system** for multi-tenant deployments, enabling private firm-specific configurations, deal data, and branded exports. It also includes significant export formatting improvements.

---

## What's New in v0.3.0

### Firm-Scoped IO System

A complete overhaul of the file organization system supporting multi-tenant deployments where each firm maintains isolated, private data.

**New Directory Structure:**
```
io/
└── {firm}/                           # e.g., "hypernova", "emerge"
    ├── configs/
    │   └── brand-{firm}-config.yaml  # Firm-specific brand styling
    ├── templates/
    │   ├── outlines/                 # Firm-specific content outlines
    │   └── scorecards/               # Firm-specific evaluation scorecards
    ├── assets/                       # Firm-wide assets (fonts, logos)
    └── deals/
        └── {deal}/                   # e.g., "Blinka", "CoachCube"
            ├── {deal}.json           # Deal configuration
            ├── inputs/               # Pitch decks, datarooms
            ├── outputs/              # Versioned memo artifacts
            ├── exports/              # Branded HTML/PDF exports
            │   ├── dark/
            │   └── light/
            └── assets/               # Deal-specific assets (logos)
```

**Key Benefits:**
- **Privacy**: Firm data stays in `io/` (gitignored or private submodule)
- **Multi-Tenant**: Multiple firms use same codebase with isolated configs
- **Backward Compatible**: Legacy `output/`, `data/`, `templates/` paths still work
- **Auto-Detection**: System auto-detects firm from `io/{firm}/deals/{deal}/` paths

---

### Resume from Interruption

New CLI tool to resume interrupted memo generation from the last successful checkpoint.

```bash
python cli/resume_from_interruption.py --firm hypernova --deal Blinka

# Resume specific version
python cli/resume_from_interruption.py --firm emerge --deal CoachCube --version v0.0.1
```

**How it works:**
- Detects last checkpoint from saved artifacts (research, sections, citations, TOC, etc.)
- Reconstructs workflow state from `state.json` and artifact files
- Resumes from the appropriate pipeline stage
- Avoids redundant API calls for completed work

---

### Export Formatting Improvements

Several fixes to the HTML/PDF export pipeline:

**Duplicate Title Fix:**
- Stripped redundant H1 (`# Investment Memo: CompanyName`) from markdown
- HTML template already provides styled header with firm branding

**Table of Contents Separator:**
- Added horizontal rule (`---`) after TOC to separate from first section
- Cleaner visual distinction in both HTML and PDF

**Logo Caption Hiding:**
- Alt text preserved for accessibility (`![CompanyName Logo](url)`)
- Added `figcaption { display: none; }` to hide visual caption
- Pandoc wraps images in `<figure>` which was exposing alt text

**Dark Mode Color Mapping:**
- Fixed color swap logic: `background` becomes text color in dark mode
- `primary` color becomes page background in dark mode
- Documented color usage in brand config YAML comments

---

### New Firm: Emerge Capital

Added complete configuration for Emerge Capital:

**Brand Colors:**
- Primary: `#021c12` (Emerge Dark Green)
- Secondary: `#df1781` (Emerge Pink)

**Custom Fonts:**
- Headers: GT Sectra Bold (local `.ttf` files)
- Body: GT America Regular (local `.woff2` files)

**Location:** `io/emerge/configs/brand-emerge-config.yaml`

---

### Updated CLI Tools

All CLI tools now support `--firm` and `--deal` flags:

| CLI Tool | New Flags |
|----------|-----------|
| `python -m src.main` | `--firm {firm}` |
| `cli/export_branded.py` | `--firm`, `--deal`, `--version` |
| `cli/resume_from_interruption.py` | `--firm`, `--deal`, `--version` |
| `cli/improve_section.py` | `--firm`, `--deal` |
| `cli/score_memo.py` | `--firm`, `--deal` |
| `cli/recompile_memo.py` | `--firm`, `--deal` |
| `cli/refocus_section.py` | `--firm`, `--deal` |

**Auto-Detection:**
When input path contains `io/{firm}/deals/{deal}/`, firm context is auto-detected:
```bash
python cli/export_branded.py io/hypernova/deals/Blinka/outputs/Blinka-v0.0.2/4-final-draft.md
# Auto-detected firm-scoped path: hypernova/Blinka
```

---

## Usage Examples

### Complete Workflow with Firm-Scoped IO

```bash
# 1. Generate memo
python -m src.main "Blinka" --firm hypernova

# 2. Improve a section
python cli/improve_section.py --firm hypernova --deal Blinka "Team"

# 3. Export to branded PDF (dark mode)
python cli/export_branded.py --firm hypernova --deal Blinka --mode dark --pdf

# 4. Or convert HTML to PDF manually
bash cli/html-to-pdf.sh io/hypernova/deals/Blinka/exports/dark/Blinka-v0.0.2.html
```

### Cross-Firm Branding

Use one firm's brand config on another firm's deal:
```bash
# Export hypernova deal with emerge branding
python cli/export_branded.py --firm hypernova --deal AiSe --brand emerge --pdf
```

Note: Cross-firm brand configs must be in `templates/brand-configs/` (not just `io/{firm}/configs/`).

---

## Installation

```bash
git clone https://github.com/lossless-group/investment-memo-orchestrator.git
cd investment-memo-orchestrator
git checkout v0.3.0

# Setup
uv venv --python python3.11
source .venv/bin/activate
uv pip install -e .

# Configure API keys
cp .env.example .env
# Edit .env with your ANTHROPIC_API_KEY, TAVILY_API_KEY, PERPLEXITY_API_KEY
```

---

## Files Changed Summary

### New Files
| File | Purpose |
|------|---------|
| `cli/resume_from_interruption.py` | Resume interrupted memo generation |
| `io/README.md` | Comprehensive firm-scoped IO documentation |
| `io/hypernova/README.md` | Hypernova-specific quick reference |
| `io/emerge/README.md` | Emerge-specific quick reference |
| `io/avalanche/README.md` | Avalanche-specific quick reference |
| `io/emerge/configs/brand-emerge-config.yaml` | Emerge Capital brand configuration |

### Modified Files (16+)
| File | Purpose |
|------|---------|
| `src/branding.py` | Firm-scoped brand config loading |
| `src/scorecard_loader.py` | Firm-scoped scorecard loading |
| `src/artifacts.py` | Firm-scoped artifact saving/loading |
| `src/workflow.py` | Firm-aware human_review() |
| `src/agents/deck_analyst.py` | Pass firm to artifact saving |
| `src/agents/writer.py` | Firm-aware output directory |
| `src/agents/research_enhanced.py` | Firm-aware artifact creation |
| `src/agents/validator.py` | Simplified firm-aware path resolution |
| `src/agents/toc_generator.py` | Added HR separator after TOC |
| `cli/export_branded.py` | Auto-detection, H1 stripping, firm-scoped exports |
| `cli/improve_section.py` | Added --firm/--deal flags |
| `cli/score_memo.py` | Added --firm/--deal flags |
| `cli/recompile_memo.py` | Added --firm/--deal flags |
| `cli/refocus_section.py` | Added --firm/--deal flags |
| `templates/base-style.css` | Added figcaption hiding |

### Moved Files (to `io/hypernova/`)
| Original | New Location |
|----------|--------------|
| `templates/brand-configs/brand-hypernova-config.yaml` | `io/hypernova/configs/` |
| `templates/outlines/direct-early-stage-12Ps.yaml` | `io/hypernova/templates/outlines/` |
| `templates/outlines/lpcommit-emerging-manager.yaml` | `io/hypernova/templates/outlines/` |
| `templates/scorecards/direct-early-stage-12Ps/` | `io/hypernova/templates/scorecards/` |

---

## Bug Fixes

| Issue | Fix |
|-------|-----|
| Duplicate "Investment Memo: Company" titles | Strip H1 from markdown before pandoc conversion |
| No separator between TOC and first section | Added `---` after TOC in toc_generator.py |
| Logo alt text showing as visible caption | CSS `figcaption { display: none; }` |
| Dark mode text appearing dark instead of light | Fixed color mapping (background = text in dark mode) |
| Resume not working with firm-scoped paths | Added `--firm`/`--deal` support to resume script |

---

## Breaking Changes

None. All changes are backward compatible:
- Legacy `output/`, `data/`, `templates/` paths continue to work
- `--firm` flag is optional; omitting it uses legacy behavior
- Auto-detection only activates for `io/` path patterns

---

## Requirements

- Python 3.11+
- `uv` package manager (NOT pip)
- API keys: Anthropic (required), Tavily (recommended), Perplexity (optional)
- WeasyPrint dependencies (for PDF export)
- Pandoc (for HTML conversion)

---

## Documentation

- **Setup**: See `README.md`
- **Architecture**: See `CLAUDE.md`
- **Firm-Scoped IO**: See `io/README.md`
- **Brand configs**: See `templates/brand-configs/README.md`
- **Changelogs**: See `changelog/` directory

---

## Acknowledgments

Built with:
- **Claude Opus 4.5 / Sonnet 4.5** (LLM)
- **LangGraph** (orchestration)
- **Tavily** (web search)
- **Perplexity Sonar Pro** (citation enrichment)
- **WeasyPrint** (PDF export)
- **Pandoc** (document conversion)

---

**Need help?** Open an issue or see [CLAUDE.md](./CLAUDE.md) for detailed usage instructions.
